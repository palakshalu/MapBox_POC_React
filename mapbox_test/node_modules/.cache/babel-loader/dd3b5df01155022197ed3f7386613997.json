{"ast":null,"code":"import utils from '../utils';\nimport template from 'lodash.template';\nimport isEqual from 'lodash.isequal';\n\nlet fs = require('fs'); // substack/brfs#39\n\n\nlet instructionsTemplate = template(fs.readFileSync(__dirname + '/../templates/instructions.html', 'utf8'));\nlet errorTemplate = template(fs.readFileSync(__dirname + '/../templates/error.html', 'utf8'));\n/**\n * Summary/Instructions controller\n *\n * @param {HTMLElement} el Summary parent container\n * @param {Object} store A redux store\n * @param {Object} actions Actions an element can dispatch\n * @param {Object} map The mapboxgl instance\n * @private\n */\n\nexport default class Instructions {\n  constructor(el, store, actions, map) {\n    this.container = el;\n    this.actions = actions;\n    this.store = store;\n    this._map = map;\n    this.directions = {};\n    this.render();\n  }\n\n  render() {\n    this.store.subscribe(() => {\n      const {\n        hoverMarker,\n        setRouteIndex\n      } = this.actions;\n      const {\n        routeIndex,\n        unit,\n        directions,\n        error,\n        compile\n      } = this.store.getState();\n      const shouldRender = !isEqual(directions[routeIndex], this.directions);\n\n      if (error) {\n        this.container.innerHTML = errorTemplate({\n          error\n        });\n        return;\n      }\n\n      if (directions.length && shouldRender) {\n        const direction = this.directions = directions[routeIndex];\n\n        if (compile) {\n          direction.legs.forEach(function (leg) {\n            leg.steps.forEach(function (step) {\n              step.maneuver.instruction = compile('en', step);\n            });\n          });\n        }\n\n        this.container.innerHTML = instructionsTemplate({\n          routeIndex,\n          routes: directions.length,\n          steps: direction.legs[0].steps,\n          // Todo: Respect all legs,\n          format: utils.format[unit],\n          duration: utils.format[unit](direction.distance),\n          distance: utils.format.duration(direction.duration)\n        });\n        const steps = this.container.querySelectorAll('.mapbox-directions-step');\n        Array.prototype.forEach.call(steps, el => {\n          const lng = el.getAttribute('data-lng');\n          const lat = el.getAttribute('data-lat');\n          el.addEventListener('mouseover', () => {\n            hoverMarker([lng, lat]);\n          });\n          el.addEventListener('mouseout', () => {\n            hoverMarker(null);\n          });\n          el.addEventListener('click', () => {\n            this._map.flyTo({\n              center: [lng, lat],\n              zoom: 16\n            });\n          });\n        });\n        const routes = this.container.querySelectorAll('input[type=\"radio\"]');\n        Array.prototype.forEach.call(routes, el => {\n          el.addEventListener('change', e => {\n            setRouteIndex(parseInt(e.target.id, 10));\n          });\n        });\n      } else if (this.container.innerHTML && shouldRender) {\n        this.container.innerHTML = '';\n      }\n    });\n  }\n\n}","map":{"version":3,"names":["utils","template","isEqual","fs","require","instructionsTemplate","readFileSync","__dirname","errorTemplate","Instructions","constructor","el","store","actions","map","container","_map","directions","render","subscribe","hoverMarker","setRouteIndex","routeIndex","unit","error","compile","getState","shouldRender","innerHTML","length","direction","legs","forEach","leg","steps","step","maneuver","instruction","routes","format","duration","distance","querySelectorAll","Array","prototype","call","lng","getAttribute","lat","addEventListener","flyTo","center","zoom","e","parseInt","target","id"],"sources":["C:/Users/Surface-Pro/React/mapbox_test/node_modules/@mapbox/mapbox-gl-directions/src/controls/instructions.js"],"sourcesContent":["import utils from '../utils';\nimport template from 'lodash.template';\nimport isEqual from 'lodash.isequal';\n\nlet fs = require('fs'); // substack/brfs#39\nlet instructionsTemplate = template(fs.readFileSync(__dirname + '/../templates/instructions.html', 'utf8'));\nlet errorTemplate = template(fs.readFileSync(__dirname + '/../templates/error.html', 'utf8'));\n\n/**\n * Summary/Instructions controller\n *\n * @param {HTMLElement} el Summary parent container\n * @param {Object} store A redux store\n * @param {Object} actions Actions an element can dispatch\n * @param {Object} map The mapboxgl instance\n * @private\n */\nexport default class Instructions {\n  constructor(el, store, actions, map) {\n    this.container = el;\n    this.actions = actions;\n    this.store = store;\n    this._map = map;\n    this.directions = {};\n    this.render();\n  }\n\n  render() {\n    this.store.subscribe(() => {\n      const { hoverMarker, setRouteIndex } = this.actions;\n      const { routeIndex, unit, directions, error, compile } = this.store.getState();\n      const shouldRender = !isEqual(directions[routeIndex], this.directions);\n\n      if (error) {\n        this.container.innerHTML = errorTemplate({ error });\n        return;\n      }\n\n      if (directions.length && shouldRender) {\n        const direction = this.directions = directions[routeIndex];\n\n        if (compile) {\n          direction.legs.forEach(function(leg) {\n            leg.steps.forEach(function(step) {\n              step.maneuver.instruction = compile('en', step);\n            });\n          });\n        }\n\n        this.container.innerHTML = instructionsTemplate({\n          routeIndex,\n          routes: directions.length,\n          steps: direction.legs[0].steps, // Todo: Respect all legs,\n          format: utils.format[unit],\n          duration: utils.format[unit](direction.distance),\n          distance: utils.format.duration(direction.duration)\n        });\n\n        const steps = this.container.querySelectorAll('.mapbox-directions-step');\n\n        Array.prototype.forEach.call(steps, (el) => {\n          const lng = el.getAttribute('data-lng');\n          const lat = el.getAttribute('data-lat');\n\n          el.addEventListener('mouseover', () => {\n            hoverMarker([lng, lat]);\n          });\n\n          el.addEventListener('mouseout', () => {\n            hoverMarker(null);\n          });\n\n          el.addEventListener('click', () => {\n            this._map.flyTo({\n              center: [lng, lat],\n              zoom: 16\n            });\n          });\n        });\n\n        const routes = this.container.querySelectorAll('input[type=\"radio\"]');\n        Array.prototype.forEach.call(routes, (el) => {\n          el.addEventListener('change', (e) => { setRouteIndex(parseInt(e.target.id, 10)); });\n        });\n      } else if (this.container.innerHTML && shouldRender) {\n        this.container.innerHTML = '';\n      }\n    });\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}